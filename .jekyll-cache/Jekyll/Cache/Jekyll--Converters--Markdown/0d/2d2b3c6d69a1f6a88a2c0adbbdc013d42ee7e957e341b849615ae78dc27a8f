I"<p><img src="/assets/images/ctf/htb-writeup-passage/logo.png" alt="center-aligned-image" class="align-center" /></p>

<p>Passage is machine where use a vulnerability in the web system, use a bad configuration of ssh keys and a d-bus configuration to gain root access.</p>

<h2 id="nmap">NMAP</h2>

<p>Using nmap we see a open ports 22 e 80</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/1.png" alt="" /></p>

<p>In the page don’t have nothing, but in source code is found a directory and emails.</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/2.png" alt="" /></p>

<p><img src="/assets/images/ctf/htb-writeup-passage/3.png" alt="" /></p>

<p>Accessing the directory, seen to be a news management system, based in this version of the system, have a rce vulnerability.</p>

<h2 id="rce">RCE</h2>
<p>Vulnerability: https://www.exploit-db.com/exploits/48800
CVE: https://nvd.nist.gov/vuln/detail/CVE-2019-11447</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/4.png" alt="" /></p>

<p>Modifying the exploit and run, we get a reverse shell.</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/5.png" alt="" /></p>

<h2 id="user">User</h2>

<p>Searching in the directories of the www-data user, found a directory with emails files.</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/6.png" alt="" /></p>

<p>But is on base 64, making the decode, found a sha256 hash.</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/7.png" alt="" /></p>

<p>Now hashcat can be use to decrypt the hash, of the user paul.</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/8.png" alt="" /></p>

<p>Now have the access to flag. The user flag is on /home/paul/user.txt .</p>

<h2 id="root">ROOT</h2>

<p>Search in ssh keys, the user nadav share de id_rsa with the user paul, so can use de id_rsa to acess the user nadav.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> id_rsa nadav@10.10.10.206
</code></pre></div></div>
<p>Now i’m the user nadav, search in the home directory, found a .viminfo.</p>

<p><img src="/assets/images/ctf/htb-writeup-passage/9.png" alt="" /></p>

<p>The groups are modified. Using this we can with a sudo user (nadav), overwrite files with permission root.</p>

<p>Source: https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/</p>

<p>Using this command is possible copy the id_rsa of the user root.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdbus call <span class="nt">--system</span> <span class="nt">--dest</span> com.ubuntu.USBCreator <span class="nt">--object-path</span> /com/ubuntu/USBCreator <span class="nt">--method</span> com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /home/nadav/id_rsa <span class="nb">true</span>
&lt;method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /home/nadav/id_rsa <span class="nb">true</span>
</code></pre></div></div>

<p>Now the id_rsa of the root, use the same method used before to gain acess.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh <span class="nt">-i</span> id_rsa root@10.10.10.206
</code></pre></div></div>
<p><img src="/assets/images/ctf/htb-writeup-passage/10.png" alt="" /></p>

:ET